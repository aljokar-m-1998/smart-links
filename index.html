<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙÙ†Ø´Ø¦ ØµÙØ­Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø°ÙƒÙŠØ© - Pro</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700&family=Cairo:wght@400;700;900&family=Tajawal:wght@400;700&family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        /* --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© --- */
        :root {
            --editor-bg: #f7f8fa;
            --preview-bg: #eef0f5;
            --widget-bg: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #555;
            --border-color: #e0e0e0;
            --accent-color: #007bff;
            --accent-hover: #0056b3;
            --danger-color: #dc3545;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --border-radius: 12px;
        }

        /* ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù„ØºØ© */
        body[lang="ar"] { font-family: 'Cairo', 'Almarai', sans-serif; }
        body[lang="en"] { font-family: 'Roboto', sans-serif; }

        body {
            margin: 0;
            background-color: var(--editor-bg);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* --- Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¹Ø§Ù… --- */
        #app-container { display: flex; width: 100%; height: 100%; }

        /* --- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø± Ø­Ø³Ø¨ RTL/LTR) --- */
        #editor-panel {
            width: 450px;
            height: 100%;
            overflow-y: auto;
            background-color: var(--widget-bg);
            padding: 25px;
            box-shadow: 0 0 15px rgba(0,0,0,0.05);
            box-sizing: border-box;
        }
        
        /* Ø¶Ø¨Ø· Ø§Ù„Ø¸Ù„ ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯ Ø­Ø³Ø¨ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ */
        html[dir="rtl"] #editor-panel { border-left: 1px solid var(--border-color); box-shadow: -5px 0 15px rgba(0,0,0,0.05); }
        html[dir="ltr"] #editor-panel { border-right: 1px solid var(--border-color); box-shadow: 5px 0 15px rgba(0,0,0,0.05); }

        #editor-panel h1 {
            font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;
        }
        
        /* --- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (ÙŠØ³Ø§Ø±/ÙŠÙ…ÙŠÙ† Ø­Ø³Ø¨ RTL/LTR) --- */
        #preview-panel {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--preview-bg);
            padding: 20px;
            height: 100%;
            overflow: hidden;
        }

        /* --- Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ --- */
        .editor-section {
            background: var(--editor-bg);
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .editor-section summary {
            font-weight: 700; padding: 15px; cursor: pointer; list-style: none;
            display: flex; justify-content: space-between; align-items: center; background: #fff;
        }
        .editor-section summary::-webkit-details-marker { display: none; }

        .form-content { padding: 15px; border-top: 1px solid var(--border-color); }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 14px; font-weight: 700; margin-bottom: 8px; color: var(--text-secondary); }

        input[type="text"], input[type="url"], textarea, select {
            width: 100%; padding: 10px; border: 1px solid var(--border-color);
            border-radius: 8px; background: #fff; box-sizing: border-box; transition: 0.2s;
            font-family: inherit;
        }
        input:focus, textarea:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(0,123,255,0.2); }

        /* --- Ø²Ø± Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© --- */
        .file-upload-wrapper {
            position: relative; overflow: hidden; display: inline-block; width: 100%;
            margin-bottom: 10px;
        }
        .file-upload-wrapper input[type=file] {
            font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer;
        }
        .file-upload-btn {
            border: 1px dashed var(--accent-color); color: var(--accent-color);
            background: rgba(0,123,255,0.05); padding: 10px; text-align: center;
            border-radius: 8px; font-weight: 700; cursor: pointer;
        }
        #profile-avatar-url { margin-top: 10px; }

        /* --- Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† --- */
        .color-picker-group { display: flex; gap: 10px; }
        input[type="color"] { -webkit-appearance: none; width: 40px; height: 40px; border: none; padding: 0; border-radius: 50%; cursor: pointer; }

        .btn {
            padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer;
            font-weight: 700; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary { background-color: var(--accent-color); color: white; }
        .btn-primary:hover { background-color: var(--accent-hover); }
        .btn-secondary { background-color: #6c757d; color: white; }
        .btn-danger { background: transparent; color: var(--danger-color); }
        .btn-danger:hover { background-color: rgba(220, 53, 69, 0.1); }
        .btn-success { background-color: #28a745; color: white; }
        .btn-success:hover { background-color: #1e7e34; }
        .btn-full { width: 100%; }
        
        #lang-toggle-btn { margin-bottom: 20px; }

        /* --- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· --- */
        #links-list .link-item {
            background-color: #fff; padding: 10px; border: 1px solid var(--border-color);
            border-radius: 8px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .drag-handle { cursor: grab; color: #aaa; font-size: 20px; padding: 0 5px; }
        .sortable-ghost { opacity: 0.4; background: #e0f0ff; }

        /* --- Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© --- */
        #preview-frame {
            width: 375px; height: 812px; background-color: white; border-radius: 40px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15); padding: 15px; box-sizing: border-box;
            position: relative; border: 8px solid #333;
        }
        #preview-content {
            width: 100%; height: 100%; background-color: #f0f0f0; border-radius: 30px;
            overflow-y: auto; text-align: center; padding: 40px 15px; box-sizing: border-box;
        }
        #preview-content::-webkit-scrollbar { display: none; }

        /* --- Modal Ùˆ Toast (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) --- */
        #modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        #modal-content {
            background: white; padding: 30px; border-radius: var(--border-radius);
            width: 90%; max-width: 450px; text-align: center; animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
        #qrcode-container { margin: 20px auto; display: flex; justify-content: center; }

        #toast {
            visibility: hidden; min-width: 250px; background-color: #333; color: #fff;
            text-align: center; border-radius: 8px; padding: 16px; position: fixed;
            z-index: 2000; left: 50%; bottom: 30px; transform: translateX(-50%);
            font-size: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

        /* --- ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) --- */
        body.render-mode { display: block; height: auto; overflow: auto; background: #fff; }
        body.render-mode #app-container { display: none; }
        #render-container { display: none; }
        body.render-mode #render-container { display: block; }

        /* --- Ø§Ù„ØªØ¬Ø§ÙˆØ¨ (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) --- */
        @media (max-width: 900px) {
            #app-container { flex-direction: column; }
            #editor-panel { width: 100%; height: auto; border-left: none; border-right: none; }
            #preview-panel { height: 100vh; position: sticky; top: 0; z-index: 10; border-top: 1px solid #ddd;}
            #preview-frame { height: 90%; width: 90%; border-width: 4px; }
        }
    </style>
</head>
<body lang="ar">

    <div id="toast" data-i18n-key="op_success">ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­</div>

    <div id="app-container">
        <div id="editor-panel">
            
            <button id="lang-toggle-btn" class="btn btn-secondary" style="float: right; margin-bottom: 20px;" data-i18n-key="lang_toggle">English ğŸ‡ºğŸ‡¸</button>
            <div style="clear: both;"></div>

            <h1 data-i18n-key="editor_title">ğŸ› ï¸ Ù…Ø­Ø±Ø± Ø§Ù„ØµÙØ­Ø©</h1>

            <details class="editor-section" open>
                <summary data-i18n-key="section_profile">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</summary>
                <div class="form-content">
                    <div class="form-group">
                        <label data-i18n-key="profile_name_label">Ø§Ù„Ø§Ø³Ù…</label>
                        <input type="text" id="profile-name" data-i18n-key-ph="profile_name_ph">
                    </div>
                    <div class="form-group">
                        <label data-i18n-key="profile_bio_label">Ù†Ø¨Ø°Ø© (Bio)</label>
                        <textarea id="profile-bio" data-i18n-key-ph="profile_bio_ph"></textarea>
                    </div>
                    <div class="form-group">
                        <label data-i18n-key="profile_avatar_label">Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ù…Ø²ÙŠØ©</label>
                        
                        <input type="url" id="profile-avatar-url" data-i18n-key-ph="avatar_url_ph">

                        <p style="text-align: center; margin: 5px 0; font-size: 12px; color: #888;" data-i18n-key="or_separator">--- Ø£Ùˆ ---</p>

                        <div class="file-upload-wrapper">
                            <div class="file-upload-btn" id="upload-btn-text" data-i18n-key="avatar_upload_btn">Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ ğŸ“ (Ù‚Ø¯ ÙŠØ·ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø·)</div>
                            <input type="file" id="profile-avatar-upload" accept="image/*">
                        </div>
                    </div>
                </div>
            </details>

            <details class="editor-section">
                <summary data-i18n-key="section_socials">Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</summary>
                <div class="form-content" id="social-links-list"></div>
            </details>

            <details class="editor-section" open>
                <summary data-i18n-key="section_links">Ø§Ù„Ø±ÙˆØ§Ø¨Ø· (Ø§Ø³Ø­Ø¨ Ù„Ù„ØªØ±ØªÙŠØ¨)</summary>
                <div class="form-content">
                    <div id="links-list"></div>
                    <button id="add-link-btn" class="btn btn-primary btn-full" data-i18n-key="add_link_btn">
                         Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯ â•
                    </button>
                </div>
            </details>

            <details class="editor-section" open>
                <summary data-i18n-key="section_design">Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†</summary>
                <div class="form-content">
                     <div class="form-group">
                        <label data-i18n-key="template_label">Ø§Ù„Ù‚Ø§Ù„Ø¨ (Ø§Ù„Ø´ÙƒÙ„)</label>
                        <select id="template-selector">
                            <option value="classic">Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label data-i18n-key="palette_label">Ø§Ù„Ø«ÙŠÙ…/Ø§Ù„Ø£Ù„ÙˆØ§Ù†</label>
                        <select id="palette-selector">
                            <option value="light">ÙØ§ØªØ­ (Light)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label data-i18n-key="customize_colors_label">ØªØ®ØµÙŠØµ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</label>
                        <div class="color-picker-group">
                            <input type="color" id="bg-color" data-i18n-title-key="color_bg_title" title="Ø§Ù„Ø®Ù„ÙÙŠØ©">
                            <input type="color" id="link-bg-color" data-i18n-title-key="color_link_bg_title" title="Ø®Ù„ÙÙŠØ© Ø§Ù„Ø²Ø±">
                            <input type="color" id="link-text-color" data-i18n-title-key="color_link_text_title" title="Ù†Øµ Ø§Ù„Ø²Ø±">
                            <input type="color" id="text-color" data-i18n-title-key="color_text_title" title="Ø§Ù„Ù†Øµ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ">
                        </div>
                    </div>
                    <div class="form-group">
                        <label data-i18n-key="button_style_label">Ø´ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±</label>
                        <select id="button-style-selector">
                            <option value="8px" data-i18n-key="btn_style_soft">Ø­ÙˆØ§Ù Ù†Ø§Ø¹Ù…Ø©</option>
                            <option value="25px" data-i18n-key="btn_style_round">Ø¯Ø§Ø¦Ø±ÙŠ ÙƒØ§Ù…Ù„</option>
                            <option value="0px" data-i18n-key="btn_style_sharp">Ù…Ø±Ø¨Ø¹ Ø­Ø§Ø¯</option>
                            <option value="neubrutalism" data-i18n-key="btn_style_neubrutalism">ØªØµÙ…ÙŠÙ… Ø­Ø§Ø¯ (Neubrutalism)</option>
                        </select>
                    </div>
                </div>
            </details>

            <div class="actions" style="margin-top: 25px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button id="generate-link-btn" class="btn btn-primary" style="flex:1;" data-i18n-key="action_save">Ø­ÙØ¸ ÙˆÙ…Ø´Ø§Ø±ÙƒØ© ğŸš€</button>
                <button id="shorten-btn" class="btn btn-success" style="flex:1;" data-i18n-key="action_shorten">ØªÙ‚ØµÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø· âœ‚ï¸</button>
                <button id="download-html-btn" class="btn btn-secondary" style="flex:1;" data-i18n-key="action_download">ØªØ­Ù…ÙŠÙ„ HTML ğŸ’¾</button>
            </div>

            <div style="margin-top: 20px; font-size: 12px; color: #888; text-align: center;" data-i18n-key="note_shorten">
                * ÙŠÙÙ†ØµØ­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… "Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±" Ù„ØªÙ…ÙƒÙŠÙ† Ø®Ø§ØµÙŠØ© ØªÙ‚ØµÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø·.
            </div>
        </div>

        <div id="preview-panel">
            <div id="preview-frame">
                <div id="preview-content">
                    </div>
            </div>
        </div>
    </div>

    <div id="render-container"></div>

    <div id="modal">
        <div id="modal-content">
            <h2 data-i18n-key="modal_title">âœ¨ ØµÙØ­ØªÙƒ Ø¬Ø§Ù‡Ø²Ø©!</h2>
            <p data-i18n-key="modal_subtitle">Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ø¯Ù†Ø§Ù‡:</p>
            <div id="qrcode-container"></div>
            <input type="text" id="generated-link" readonly style="direction: ltr; text-align: center; margin-bottom: 10px;">
            <div style="display: flex; gap: 10px;">
                <button id="copy-link-btn" class="btn btn-primary" style="flex:1;" data-i18n-key="modal_copy_btn">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
                <button id="close-modal-btn" class="btn btn-secondary" style="flex:1;" data-i18n-key="modal_close_btn">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
            <p style="font-size: 12px; margin-top: 15px; color: #555;" data-i18n-key="modal_note">(Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¸Ø§Ù‡Ø± Ø·ÙˆÙŠÙ„Ø§Ù‹ØŒ ÙÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªÙŠ Ø±ÙØ¹ØªÙ‡Ø§ ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹.)</p>
        </div>
    </div>

    <script>
    
    // --- Ù…ØªØºÙŠØ± Ø§Ù„Ù„ØºØ© Ø§Ù„Ø­Ø§Ù„ÙŠ ---
    let currentLang = 'ar'; 

    // --- ÙƒØ§Ø¦Ù†Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„ØªØ±Ø¬Ù…Ø© ---

    const translations = {
        'ar': {
            'lang_toggle': 'English ğŸ‡ºğŸ‡¸',
            'editor_title': 'ğŸ› ï¸ Ù…Ø­Ø±Ø± Ø§Ù„ØµÙØ­Ø©',
            'section_profile': 'Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©',
            'profile_name_label': 'Ø§Ù„Ø§Ø³Ù…',
            'profile_name_ph': 'Ø§Ø³Ù…Ùƒ Ø£Ùˆ Ø¹Ù„Ø§Ù…ØªÙƒ Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©',
            'profile_bio_label': 'Ù†Ø¨Ø°Ø© (Bio)',
            'profile_bio_ph': 'ÙˆØµÙ Ù…Ø®ØªØµØ±...',
            'profile_avatar_label': 'Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ù…Ø²ÙŠØ©',
            'avatar_url_ph': 'Ø£Ùˆ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (Ù„ØªÙ‚ØµÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø·)',
            'or_separator': '--- Ø£Ùˆ ---',
            'avatar_upload_btn': 'Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ ğŸ“ (Ù‚Ø¯ ÙŠØ·ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø·)',
            'avatar_upload_success': 'âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­ (Ø±Ø§Ø¨Ø· Ø·ÙˆÙŠÙ„)',
            'section_socials': 'Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ',
            'section_links': 'Ø§Ù„Ø±ÙˆØ§Ø¨Ø· (Ø§Ø³Ø­Ø¨ Ù„Ù„ØªØ±ØªÙŠØ¨)',
            'add_link_btn': 'Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯ â•',
            'link_title_ph': 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†',
            'link_url_ph': 'Ø§Ù„Ø±Ø§Ø¨Ø· (https://...)',
            'section_design': 'Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†',
            'template_label': 'Ø§Ù„Ù‚Ø§Ù„Ø¨ (Ø§Ù„Ø´ÙƒÙ„)',
            'template_classic': 'Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ (Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ)',
            'template_sidebar': 'Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ (Linktree Style)',
            'template_hero': 'Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø¹Ø±ÙŠØ¶ (Ù„Ù„Ù…Ø­ØªØ±ÙÙŠÙ†)',
            'palette_label': 'Ø§Ù„Ø«ÙŠÙ…/Ø§Ù„Ø£Ù„ÙˆØ§Ù†',
            'palette_light': 'ÙØ§ØªØ­ (Light)',
            'palette_dark': 'Ø¯Ø§ÙƒÙ† (Dark)',
            'palette_simple_pro': 'â­ï¸ Ø¨Ø³ÙŠØ· Ø§Ø­ØªØ±Ø§ÙÙŠ',
            'palette_motion_pro': 'âœ¨ Ø­Ø±ÙƒÙŠ Ù…Ù…ÙŠØ²',
            'palette_custom': 'ğŸ¨ Ù…Ø®ØµØµ',
            'customize_colors_label': 'ØªØ®ØµÙŠØµ Ø§Ù„Ø£Ù„ÙˆØ§Ù†',
            'color_bg_title': 'Ø§Ù„Ø®Ù„ÙÙŠØ©',
            'color_link_bg_title': 'Ø®Ù„ÙÙŠØ© Ø§Ù„Ø²Ø±',
            'color_link_text_title': 'Ù†Øµ Ø§Ù„Ø²Ø±',
            'color_text_title': 'Ø§Ù„Ù†Øµ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ',
            'button_style_label': 'Ø´ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±',
            'btn_style_soft': 'Ø­ÙˆØ§Ù Ù†Ø§Ø¹Ù…Ø©',
            'btn_style_round': 'Ø¯Ø§Ø¦Ø±ÙŠ ÙƒØ§Ù…Ù„',
            'btn_style_sharp': 'Ù…Ø±Ø¨Ø¹ Ø­Ø§Ø¯',
            'btn_style_neubrutalism': 'ØªØµÙ…ÙŠÙ… Ø­Ø§Ø¯ (Neubrutalism)',
            'action_save': 'Ø­ÙØ¸ ÙˆÙ…Ø´Ø§Ø±ÙƒØ© ğŸš€',
            'action_shorten': 'ØªÙ‚ØµÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø· âœ‚ï¸',
            'action_download': 'ØªØ­Ù…ÙŠÙ„ HTML ğŸ’¾',
            'note_shorten': '* ÙŠÙÙ†ØµØ­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… "Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±" Ù„ØªÙ…ÙƒÙŠÙ† Ø®Ø§ØµÙŠØ© ØªÙ‚ØµÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø·.',
            'modal_title': 'âœ¨ ØµÙØ­ØªÙƒ Ø¬Ø§Ù‡Ø²Ø©!',
            'modal_subtitle': 'Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ø¯Ù†Ø§Ù‡:',
            'modal_copy_btn': 'Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·',
            'modal_close_btn': 'Ø¥ØºÙ„Ø§Ù‚',
            'modal_note': '(Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¸Ø§Ù‡Ø± Ø·ÙˆÙŠÙ„Ø§Ù‹ØŒ ÙÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªÙŠ Ø±ÙØ¹ØªÙ‡Ø§ ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹.)',
            'op_success': 'ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­',
            'op_shortening': 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‚ØµÙŠØ±... â³',
            'op_shorten_success': 'ØªÙ… ØªÙ‚ØµÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰',
            'alert_img_size': 'âš ï¸ Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ù‚Ù„ Ù…Ù† 500 ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ.',
            'alert_long_url': 'âš ï¸ Ø§Ù„Ø±Ø§Ø¨Ø· Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§Ù‹ (Ø·ÙˆÙ„Ù‡: %length% Ø­Ø±Ù). Ù„Ù† ØªØªÙ…ÙƒÙ† Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªÙ‚ØµÙŠØ± Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© Ù…Ù† Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø®Ø§Ø±Ø¬ÙŠ Ø£Ùˆ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø·ÙˆÙŠÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹.',
            'alert_shorten_fail': 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙ‚ØµÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø·. ØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø·ÙˆÙŠÙ„ ÙƒØ¨Ø¯ÙŠÙ„.',
            'alert_data_error': 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ø§Ø¨Ø·ØŒ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø­Ø±Ø±...'
        },
        'en': {
            'lang_toggle': 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸ‡¸ğŸ‡¦',
            'editor_title': 'ğŸ› ï¸ Page Editor',
            'section_profile': 'Personal Info',
            'profile_name_label': 'Name',
            'profile_name_ph': 'Your Name or Brand',
            'profile_bio_label': 'Bio',
            'profile_bio_ph': 'Short description...',
            'profile_avatar_label': 'Avatar Image',
            'avatar_url_ph': 'Or a direct image link (for shortening)',
            'or_separator': '--- OR ---',
            'avatar_upload_btn': 'Choose file ğŸ“ (May result in a long URL)',
            'avatar_upload_success': 'âœ… Image uploaded successfully (Long URL)',
            'section_socials': 'Social Links',
            'section_links': 'Links (Drag to reorder)',
            'add_link_btn': 'Add New Link â•',
            'link_title_ph': 'Title',
            'link_url_ph': 'URL (https://...)',
            'section_design': 'Design & Colors',
            'template_label': 'Template (Layout)',
            'template_classic': 'Classic (Center Profile)',
            'template_sidebar': 'Sidebar (Linktree Style)',
            'template_hero': 'Wide Banner (Pro)',
            'palette_label': 'Theme/Colors',
            'palette_light': 'Light',
            'palette_dark': 'Dark',
            'palette_simple_pro': 'â­ï¸ Simple Pro',
            'palette_motion_pro': 'âœ¨ Motion Pro',
            'palette_custom': 'ğŸ¨ Custom',
            'customize_colors_label': 'Customize Colors',
            'color_bg_title': 'Background',
            'color_link_bg_title': 'Button Background',
            'color_link_text_title': 'Button Text',
            'color_text_title': 'Primary Text',
            'button_style_label': 'Button Style',
            'btn_style_soft': 'Soft Edges',
            'btn_style_round': 'Full Round',
            'btn_style_sharp': 'Sharp Square',
            'btn_style_neubrutalism': 'Neubrutalism',
            'action_save': 'Save & Share ğŸš€',
            'action_shorten': 'Shorten Link âœ‚ï¸',
            'action_download': 'Download HTML ğŸ’¾',
            'note_shorten': '* Direct image URLs are recommended for link shortening feature.',
            'modal_title': 'âœ¨ Your page is ready!',
            'modal_subtitle': 'Scan the code or copy the link below:',
            'modal_copy_btn': 'Copy Link',
            'modal_close_btn': 'Close',
            'modal_note': '(If the link appears very long, it means your uploaded image file is large.)',
            'op_success': 'Operation successful',
            'op_shortening': 'Shortening... â³',
            'op_shorten_success': 'Link successfully shortened! ğŸ‰',
            'alert_img_size': 'âš ï¸ Image is too large. Please select an image less than 500KB or use an external link.',
            'alert_long_url': 'âš ï¸ The link is very long (length: %length% chars). Free shortening services cannot handle it. Please use an external image link or copy the long link manually.',
            'alert_shorten_fail': 'Sorry, an error occurred while shortening the link. The long link modal was opened as an alternative.',
            'alert_data_error': 'Error reading link data, returning to editor...'
        }
    };
    
    // Ø§Ù„Ø«ÙŠÙ…Ø§Øª ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†
    const colorPalettes = {
        'light': { bg: '#f7f8fa', lBg: '#ffffff', lTxt: '#1a1a1a', txt: '#1a1a1a', btnRadius: '8px' },
        'dark': { bg: '#121212', lBg: '#2a2a2a', lTxt: '#ffffff', txt: '#ffffff', btnRadius: '8px' },
        'simple-pro': { bg: '#f9f9f9', lBg: '#000000', lTxt: '#ffffff', txt: '#333333', btnRadius: '25px' },
        'motion-pro': { bg: 'linear-gradient(180deg, #1e3c72 0%, #2a5298 100%)', lBg: 'rgba(255,255,255,0.95)', lTxt: '#2a5298', txt: '#ffffff', btnRadius: '12px' },
        'blue': { bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', lBg: 'rgba(255,255,255,0.9)', lTxt: '#4a4a4a', txt: '#ffffff', btnRadius: '8px' },
        'pink': { bg: 'linear-gradient(45deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%)', lBg: '#fff0f3', lTxt: '#d63384', txt: '#4a001f', btnRadius: '8px' },
        'elegant': { bg: '#000000', lBg: '#D4AF37', lTxt: '#000000', txt: '#D4AF37', btnRadius: '8px' },
        'custom': { bg: '#f7f8fa', lBg: '#ffffff', lTxt: '#1a1a1a', txt: '#1a1a1a', btnRadius: '8px' } // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„ØªØ®ØµÙŠØµ
    };

    // Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ (Templates) ØªØ­Ø¯Ø¯ Ø§Ù„Ù‡ÙŠÙƒÙ„ (Layout) ÙˆØ§Ù„Ø«ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    const templates = {
        'classic': { id: 'classic', arName: 'Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ (Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ)', enName: 'Classic (Center Profile)', layout: 'classic', defaultPalette: 'light' },
        'sidebar': { id: 'sidebar', arName: 'Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ (Linktree Style)', enName: 'Sidebar (Linktree Style)', layout: 'sidebar', defaultPalette: 'dark' },
        'hero': { id: 'hero', arName: 'Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø¹Ø±ÙŠØ¶ (Ù„Ù„Ù…Ø­ØªØ±ÙÙŠÙ†)', enName: 'Wide Banner (Pro)', layout: 'hero', defaultPalette: 'motion-pro' }
    };

    // Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª SVG (ÙƒÙ…Ø§ Ù‡ÙŠ)
    const icons = { /* ... (Ø¨Ù‚ÙŠØ© Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª SVG Ù„Ù… ØªØªØºÙŠØ±) ... */ 
            twitter: '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>',
            instagram: '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.85s.012-3.584.07-4.85c.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.85-.069zM12 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zm0 10.162a3.999 3.999 0 110-7.998 3.999 3.999 0 010 7.998z"/></svg>',
            facebook: '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"/></svg>',
            linkedin: '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452z"/></svg>',
            whatsapp: '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>'
        };

    document.addEventListener('DOMContentLoaded', () => {

        // --- ÙˆØ¸Ø§Ø¦Ù Ø¯Ø¹Ù… Ø§Ù„Ù„ØºØ§Øª ---

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            const isRTL = lang === 'ar';
            
            // 1. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ÙˆØ§Ù„Ù„ØºØ©
            document.documentElement.setAttribute('lang', lang);
            document.documentElement.setAttribute('dir', isRTL ? 'rtl' : 'ltr');
            document.body.setAttribute('lang', lang);
            
            // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ (i18n)
            document.querySelectorAll('[data-i18n-key]').forEach(el => {
                const key = el.getAttribute('data-i18n-key');
                if (t[key]) {
                    el.innerHTML = t[key];
                }
            });

            // 3. ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¯Ø®Ù„Ø© (Placeholders)
            document.querySelectorAll('[data-i18n-key-ph]').forEach(el => {
                const key = el.getAttribute('data-i18n-key-ph');
                if (t[key]) {
                    el.placeholder = t[key];
                }
            });

            // 4. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† (Titles)
            document.querySelectorAll('[data-i18n-title-key]').forEach(el => {
                const key = el.getAttribute('data-i18n-title-key');
                if (t[key]) {
                    el.title = t[key];
                }
            });

            // 5. ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù€ Select Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
            updateDesignSelectors(lang);
            
            // 6. ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø±ÙØ¹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙˆØ±Ø© Ù…Ø±ÙÙˆØ¹Ø©
            if (config.profile.avatar.startsWith('data:')) {
                document.getElementById('upload-btn-text').textContent = t['avatar_upload_success'];
            }
        }
        
        function updateDesignSelectors(lang) {
            const templateSelector = document.getElementById('template-selector');
            const paletteSelector = document.getElementById('palette-selector');
            const t = translations[lang];
            
            // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
            templateSelector.innerHTML = '';
            Object.values(templates).forEach(tpl => {
                const option = document.createElement('option');
                option.value = tpl.id;
                option.textContent = tpl[`${lang}Name`];
                templateSelector.appendChild(option);
            });
            templateSelector.value = config.design.templateId; // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©

            // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø«ÙŠÙ…Ø§Øª
            paletteSelector.innerHTML = '';
            Object.keys(colorPalettes).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = t[`palette_${key}`] || key;
                paletteSelector.appendChild(option);
            });
            paletteSelector.value = config.design.paletteId; // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©

            // ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù€ Button Style
            document.getElementById('button-style-selector').querySelectorAll('option').forEach(option => {
                const key = option.getAttribute('data-i18n-key');
                if (t[key]) option.textContent = t[key];
            });
        }
        
        // --- ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ---
        
        function escapeHtml(text) {
            if (!text) return "";
            return String(text)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function showToast(message) {
            const x = document.getElementById("toast");
            x.textContent = message;
            x.className = "show";
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
        }

        // --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ---
        
        let config = {
            profile: { name: translations['ar'].profile_name_ph, bio: translations['ar'].profile_bio_ph, avatar: 'https://cdn-icons-png.flaticon.com/512/847/847969.png' },
            socials: { twitter: '', instagram: '', facebook: '', linkedin: '', whatsapp: '' },
            links: [ { title: 'Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ğŸŒ', url: 'https://google.com' } ],
            // ØªÙ… ØªØºÙŠÙŠØ± 'theme' Ø¥Ù„Ù‰ 'templateId' Ùˆ 'paletteId'
            design: { templateId: 'classic', paletteId: 'light', bgColor: colorPalettes.light.bg, linkBgColor: colorPalettes.light.lBg, linkTextColor: colorPalettes.light.lTxt, textColor: colorPalettes.light.txt, btnRadius: colorPalettes.light.btnRadius }
        };

        function initializeApp() {
            // Ø¹Ù†Ø§ØµØ± DOM
            const els = {
                // ... (Ø§Ù„ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©) ...
                name: document.getElementById('profile-name'),
                bio: document.getElementById('profile-bio'),
                avatarUpload: document.getElementById('profile-avatar-upload'),
                avatarUrlInput: document.getElementById('profile-avatar-url'),
                avatarBtnText: document.getElementById('upload-btn-text'),
                linksList: document.getElementById('links-list'),
                socialsList: document.getElementById('social-links-list'),
                preview: document.getElementById('preview-content'),
                templateSelector: document.getElementById('template-selector'), // Ø¬Ø¯ÙŠØ¯
                paletteSelector: document.getElementById('palette-selector'),   // Ø¬Ø¯ÙŠØ¯
                colors: {
                    bg: document.getElementById('bg-color'),
                    linkBg: document.getElementById('link-bg-color'),
                    linkText: document.getElementById('link-text-color'),
                    text: document.getElementById('text-color')
                },
                btnStyle: document.getElementById('button-style-selector'),
                addLink: document.getElementById('add-link-btn'),
                generate: document.getElementById('generate-link-btn'),
                shorten: document.getElementById('shorten-btn'),
                download: document.getElementById('download-html-btn'),
                langToggle: document.getElementById('lang-toggle-btn'), // Ø¬Ø¯ÙŠØ¯
                modal: {
                    self: document.getElementById('modal'),
                    input: document.getElementById('generated-link'),
                    copy: document.getElementById('copy-link-btn'),
                    close: document.getElementById('close-modal-btn'),
                    qr: document.getElementById('qrcode-container')
                }
            };
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„ØºØ© (Ø§Ù„ØªÙØ¶ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹)
            setLanguage(currentLang);


            // --- ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (Core Rendering) ---
            function renderPreview() {
                const palette = colorPalettes[config.design.paletteId] || config.design;
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù„ÙˆØ§Ù†
                els.preview.style.background = config.design.bgColor;
                els.preview.style.color = config.design.textColor;

                let html = '';
                const currentTemplate = templates[config.design.templateId];

                // 1. Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ù„Ø¨
                const avatarHtml = `<img src="${escapeHtml(config.profile.avatar)}" style="width:100px; height:100px; border-radius:50%; object-fit:cover; border:3px solid #fff; box-shadow:0 5px 15px rgba(0,0,0,0.1); margin-bottom:10px;">`;
                const profileHtml = `
                    <h2 style="margin:5px 0 10px; font-weight:900;">${escapeHtml(config.profile.name)}</h2>
                    <p style="margin:0 auto 20px; opacity:0.9; max-width:90%; font-size:14px; line-height:1.5;">${escapeHtml(config.profile.bio)}</p>
                `;

                // 2. Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ
                let socialHtml = '<div style="display:flex; justify-content:center; gap:15px; margin-bottom:25px;">';
                for (const [key, val] of Object.entries(config.socials)) {
                    if (val && icons[key]) {
                        let href = val;
                        if (key === 'whatsapp' && !val.startsWith('http')) href = `https://wa.me/${val.replace(/[^0-9]/g, '')}`;
                        else if (!val.startsWith('http')) href = `https://${key}.com/${val}`;
                        socialHtml += `<a href="${escapeHtml(href)}" target="_blank" style="color:inherit; transition:transform 0.2s; display:block;">${icons[key]}</a>`;
                    }
                }
                socialHtml += '</div>';

                // 3. Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                let linksHtml = '<div style="display:flex; flex-direction:column; gap:15px;">';
                config.links.forEach(link => {
                    let borderStyle = '';
                    let extraStyles = '';

                    if (config.design.btnRadius === 'neubrutalism') {
                        borderStyle = `border: 2px solid ${config.design.textColor}; box-shadow: 4px 4px 0 ${config.design.textColor}; border-radius: 0;`;
                    } else {
                        borderStyle = `border-radius: ${config.design.btnRadius}; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: none;`;
                    }

                    if (config.design.paletteId === 'motion-pro') {
                        extraStyles = 'transform: scale(0.98); opacity: 0.9;';
                    }

                    linksHtml += `
                        <a href="${escapeHtml(link.url)}" target="_blank" style="
                            background-color: ${config.design.linkBgColor};
                            color: ${config.design.linkTextColor};
                            padding: 16px;
                            text-decoration: none;
                            font-weight: bold;
                            display: block;
                            width: 90%;
                            margin: 0 auto;
                            transition: all 0.2s;
                            ${borderStyle}
                            ${extraStyles}
                        ">${escapeHtml(link.title)}</a>
                    `;
                });
                linksHtml += '</div>';
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                if (currentTemplate.id === 'sidebar') {
                    // Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ (ÙŠØ´Ø¨Ù‡ Linktree)
                    html = `
                        <div style="display:flex; flex-direction:row; gap: 20px; align-items: flex-start; text-align: start; width:100%; max-width: 300px; margin: 0 auto;">
                            <div style="flex-shrink: 0; text-align: center;">
                                ${avatarHtml}
                                ${socialHtml.replace('justify-content:center', 'justify-content:center')}
                            </div>
                            <div style="flex-grow: 1;">
                                <h2 style="margin:5px 0 5px; font-weight:900;">${escapeHtml(config.profile.name)}</h2>
                                <p style="margin:0 auto 20px; opacity:0.9; font-size:12px; line-height:1.5;">${escapeHtml(config.profile.bio)}</p>
                            </div>
                        </div>
                        <div style="width: 100%; margin-top: 20px;">${linksHtml}</div>
                    `;
                    els.preview.style.textAlign = 'center'; // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
                    
                } else if (currentTemplate.id === 'hero') {
                    // Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø¹Ø±ÙŠØ¶
                    html = `
                        <div style="width: 100%; height: 100px; background: ${config.design.linkBgColor}; margin: -40px 0 10px; border-radius: 30px 30px 0 0;"></div>
                        <div style="margin-top: -60px; position: relative;">${avatarHtml}</div>
                        ${profileHtml}
                        ${socialHtml}
                        ${linksHtml}
                    `;
                } else {
                    // Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)
                    html = `${avatarHtml}${profileHtml}${socialHtml}${linksHtml}`;
                }


                els.preview.innerHTML = html;
            }

            // --- Ù…Ø²Ø§Ù…Ù†Ø© UI Ù…Ø¹ Config ---
            function syncUI() {
                els.name.value = config.profile.name;
                els.bio.value = config.profile.bio;

                // Ø§Ù„ØµÙˆØ±Ø©
                const t = translations[currentLang];
                if (config.profile.avatar.startsWith('data:')) {
                    els.avatarUrlInput.value = '';
                    els.avatarBtnText.textContent = t['avatar_upload_success'];
                } else {
                    els.avatarUrlInput.value = config.profile.avatar;
                    els.avatarBtnText.textContent = t['avatar_upload_btn'];
                }

                // Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ
                els.socialsList.innerHTML = '';
                Object.keys(config.socials).forEach(key => {
                    const div = document.createElement('div');
                    div.className = 'form-group';
                    const placeholder = key === 'whatsapp' ? (currentLang === 'ar' ? 'Ù…Ø«Ø§Ù„: 201xxxxxxx' : 'Example: 1234567890') : (currentLang === 'ar' ? 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… / Ø±Ø§Ø¨Ø·' : 'username / url');
                    div.innerHTML = `<label style="text-transform:capitalize">${key}</label><input type="text" data-social="${key}" value="${config.socials[key]}" placeholder="${placeholder}">`;
                    els.socialsList.appendChild(div);
                });

                // Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
                renderLinksList();

                // Ø§Ù„ØªØµÙ…ÙŠÙ…
                els.colors.bg.value = config.design.bgColor.startsWith('#') ? config.design.bgColor : '#ffffff';
                els.colors.linkBg.value = config.design.linkBgColor.startsWith('#') ? config.design.linkBgColor : '#ffffff';
                els.colors.linkText.value = config.design.linkTextColor.startsWith('#') ? config.design.linkTextColor : '#000000';
                els.colors.text.value = config.design.textColor.startsWith('#') ? config.design.textColor : '#1a1a1a';
                
                els.templateSelector.value = config.design.templateId;
                els.paletteSelector.value = config.design.paletteId;
                els.btnStyle.value = config.design.btnRadius;
                
                renderPreview();
            }

            function renderLinksList() {
                els.linksList.innerHTML = '';
                const t = translations[currentLang];
                config.links.forEach((link, idx) => {
                    const div = document.createElement('div');
                    div.className = 'link-item';
                    div.setAttribute('data-id', idx);
                    div.innerHTML = `
                        <span class="drag-handle">â˜°</span>
                        <div style="flex:1;">
                            <input type="text" class="link-title" value="${escapeHtml(link.title)}" placeholder="${t.link_title_ph}" style="margin-bottom:5px;">
                            <input type="url" class="link-url" value="${escapeHtml(link.url)}" placeholder="${t.link_url_ph}">
                        </div>
                        <button class="btn btn-danger delete-btn">ğŸ—‘ï¸</button>
                    `;
                    els.linksList.appendChild(div);
                });
            }

            // --- Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø£Ø­Ø¯Ø§Ø« (Event Listeners) ---
            
            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
            els.langToggle.addEventListener('click', () => {
                const newLang = currentLang === 'ar' ? 'en' : 'ar';
                setLanguage(newLang);
                syncUI(); // Ø£Ø¹Ø¯ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ù„ØªØ­Ø¯ÙŠØ« PH Ùˆ Titles)
            });

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„Ø«ÙŠÙ…
            function applyPalette(paletteId) {
                const p = colorPalettes[paletteId];
                if(p) {
                    config.design.paletteId = paletteId;
                    config.design.bgColor = p.bg;
                    config.design.linkBgColor = p.lBg;
                    config.design.linkTextColor = p.lTxt;
                    config.design.textColor = p.txt;
                    config.design.btnRadius = p.btnRadius;
                    syncUI();
                }
            }
            
            els.templateSelector.addEventListener('change', (e) => {
                const templateId = e.target.value;
                config.design.templateId = templateId;
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                const defaultPalette = templates[templateId].defaultPalette;
                applyPalette(defaultPalette);
            });
            
            els.paletteSelector.addEventListener('change', (e) => {
                applyPalette(e.target.value);
            });


            // ... (Ø¨Ù‚ÙŠØ© Ø§Ù„Ù€ Event Listeners Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©) ...

            [els.name, els.bio].forEach(el => el.addEventListener('input', () => {
                config.profile[el.id === 'profile-name' ? 'name' : 'bio'] = el.value;
                renderPreview();
            }));

            els.avatarUrlInput.addEventListener('input', () => {
                config.profile.avatar = els.avatarUrlInput.value || 'https://cdn-icons-png.flaticon.com/512/847/847969.png';
                els.avatarBtnText.textContent = translations[currentLang]['avatar_upload_btn'];
                els.avatarUpload.value = '';
                renderPreview();
            });

            els.avatarUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 500 * 1024) { 
                        alert(translations[currentLang]['alert_img_size']);
                        e.target.value = '';
                        return;
                    }
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        config.profile.avatar = event.target.result;
                        els.avatarUrlInput.value = '';
                        els.avatarBtnText.textContent = translations[currentLang]['avatar_upload_success'];
                        renderPreview();
                    };
                    reader.readAsDataURL(file);
                }
            });

            els.socialsList.addEventListener('input', (e) => {
                if(e.target.tagName === 'INPUT') {
                    config.socials[e.target.dataset.social] = e.target.value;
                    renderPreview();
                }
            });

            els.addLink.addEventListener('click', () => {
                config.links.push({ title: translations[currentLang]['link_title_ph'], url: '#' });
                syncUI();
            });

            els.linksList.addEventListener('input', (e) => {
                const itemEl = e.target.closest('.link-item');
                if (!itemEl) return;
                const idx = itemEl.dataset.id;
                if(e.target.classList.contains('link-title')) config.links[idx].title = e.target.value;
                if(e.target.classList.contains('link-url')) config.links[idx].url = e.target.value;
                renderPreview();
            });

            els.linksList.addEventListener('click', (e) => {
                if(e.target.classList.contains('delete-btn') || e.target.parentElement.classList.contains('delete-btn')) {
                    const idx = e.target.closest('.link-item').dataset.id;
                    config.links.splice(idx, 1);
                    syncUI();
                }
            });

            new Sortable(els.linksList, {
                handle: '.drag-handle',
                animation: 150,
                ghostClass: 'sortable-ghost',
                onEnd: function (evt) {
                    const item = config.links.splice(evt.oldIndex, 1)[0];
                    config.links.splice(evt.newIndex, 0, item);
                    syncUI(); 
                }
            });

            Object.values(els.colors).forEach(input => {
                input.addEventListener('input', () => {
                    config.design.bgColor = els.colors.bg.value;
                    config.design.linkBgColor = els.colors.linkBg.value;
                    config.design.linkTextColor = els.colors.linkText.value;
                    config.design.textColor = els.colors.text.value;
                    config.design.paletteId = 'custom';
                    els.paletteSelector.value = 'custom';
                    renderPreview();
                });
            });

            els.btnStyle.addEventListener('change', (e) => {
                config.design.btnRadius = e.target.value;
                renderPreview();
            });

            // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø·ÙˆÙŠÙ„
            function getLongUrl() {
                const jsonString = JSON.stringify(config);
                const compressed = LZString.compressToEncodedURIComponent(jsonString);
                return `${window.location.origin}${window.location.pathname}#data=${compressed}`;
            }

            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø·ÙˆÙŠÙ„ Ù…Ø¹ QR Code
            els.generate.addEventListener('click', () => {
                const url = getLongUrl();
                els.modal.input.value = url;
                els.modal.qr.innerHTML = ''; 
                try {
                    new QRCode(els.modal.qr, {
                        text: url,
                        width: 128,
                        height: 128,
                        colorDark : "#000000",
                        colorLight : "#ffffff",
                        correctLevel : QRCode.CorrectLevel.H
                    });
                } catch (e) {
                     els.modal.qr.innerHTML = '<p style="color:red; font-weight:bold;">Ø§Ù„Ø±Ø§Ø¨Ø· Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§Ù‹ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙˆÙ„ÙŠØ¯ QR Code.</p>';
                }
                els.modal.self.style.display = 'flex';
            });

            // ØªÙ‚ØµÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø·
            els.shorten.addEventListener('click', async () => {
                const longUrl = getLongUrl();
                
                // ØªØ­Ø°ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø·ÙˆÙŠÙ„Ø§Ù‹ Ø¬Ø¯Ø§Ù‹
                if (longUrl.length > 2000) {
                    const message = translations[currentLang]['alert_long_url'].replace('%length%', longUrl.length);
                    alert(message);
                    els.generate.click();
                    return;
                }

                const originalText = els.shorten.innerText;
                els.shorten.innerText = translations[currentLang]['op_shortening'];
                els.shorten.disabled = true;

                try {
                    const response = await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(longUrl)}`);

                    if (response.ok) {
                        const shortUrl = await response.text();
                        if (shortUrl.startsWith('Error')) throw new Error(shortUrl);

                        els.modal.input.value = shortUrl;
                        els.modal.qr.innerHTML = '';
                        new QRCode(els.modal.qr, { text: shortUrl, width: 128, height: 128 });

                        els.modal.self.style.display = 'flex';
                        showToast(translations[currentLang]['op_shorten_success']);
                    } else {
                        throw new Error('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø¯Ù…Ø©');
                    }
                } catch (error) {
                    console.error(error);
                    alert(translations[currentLang]['alert_shorten_fail']);
                    els.generate.click(); 
                } finally {
                    els.shorten.innerText = originalText;
                    els.shorten.disabled = false;
                }
            });


            els.modal.copy.addEventListener('click', () => {
                els.modal.input.select();
                document.execCommand('copy');
                showToast(translations[currentLang]['op_success']);
            });

            els.modal.close.addEventListener('click', () => {
                els.modal.self.style.display = 'none';
            });

            // ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù HTML Ø«Ø§Ø¨Øª
            els.download.addEventListener('click', () => {
                const finalHTML = generateFinalHTML(config);
                const blob = new Blob([finalHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${config.profile.name.replace(/[^a-zA-Z0-9]/g, '-')}-links.html`;
                a.click();
                URL.revokeObjectURL(url);
                showToast(translations[currentLang]['op_success']);
            });

            // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            syncUI();
        }

        // --- ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ‡ÙŠØ£Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ---
        if (window.location.hash && window.location.hash.startsWith('#data=')) {
            try {
                const encodedData = window.location.hash.substring(6);
                const decompressedData = LZString.decompressFromEncodedURIComponent(encodedData);
                const decodedData = JSON.parse(decompressedData);
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ØºØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø£Ùˆ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                if (decodedData.design && decodedData.design.lang) currentLang = decodedData.design.lang;

                document.body.classList.add('render-mode');
                document.getElementById('render-container').innerHTML = generateFinalHTML(decodedData);
                document.title = `${escapeHtml(decodedData.profile.name)} | Links`;
            } catch (error) {
                console.error("Data error:", error);
                showToast(translations[currentLang]['alert_data_error']);
                setTimeout(initializeApp, 1500);
            }
        } else {
            initializeApp();
        }
    });

    // --- ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© (Standalone) ---
    function generateFinalHTML(data) {
        const safeName = escapeHtml(data.profile.name);
        const safeBio = escapeHtml(data.profile.bio);
        const safeAvatar = escapeHtml(data.profile.avatar);
        const palette = data.design.paletteId;
        const templateId = data.design.templateId;
        const lang = data.design.lang || 'ar'; 
        const isRTL = lang === 'ar';
        const fontFamily = lang === 'ar' ? 'Cairo' : 'Roboto';

        const svgs = {
            // ... (Ù†ÙØ³ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª SVG Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©) ...
            twitter: '<svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>',
            instagram: '<svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.85s.012-3.584.07-4.85c.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.85-.069zM12 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zm0 10.162a3.999 3.999 0 110-7.998 3.999 3.999 0 010 7.998z"/></svg>',
            facebook: '<svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"/></svg>',
            linkedin: '<svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452z"/></svg>',
            whatsapp: '<svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>'
        };

        let socialHTML = '';
        for (const [key, val] of Object.entries(data.socials)) {
            if (val && svgs[key]) {
                 let href = val;
                if (key === 'whatsapp' && !val.startsWith('http')) href = `https://wa.me/${val.replace(/[^0-9]/g, '')}`;
                else if (!val.startsWith('http')) href = `https://${key}.com/${val}`;
                socialHTML += `<a href="${escapeHtml(href)}" target="_blank" class="social-icon">${svgs[key]}</a>`;
            }
        }

        let linksHTML = data.links.map(link => {
             let borderStyle = data.design.btnRadius === 'neubrutalism' 
                    ? `border: 2px solid ${data.design.textColor}; box-shadow: 4px 4px 0 ${data.design.textColor}; border-radius: 0;` 
                    : `border-radius: ${data.design.btnRadius}; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: none;`;

            return `<a href="${escapeHtml(link.url)}" target="_blank" class="link-btn" style="background-color:${data.design.linkBgColor}; color:${data.design.linkTextColor}; ${borderStyle}">${escapeHtml(link.title)}</a>`;
        }).join('');

        // --- Styles & Layouts based on Template ---
        
        // Motion Pro specific CSS for hover effects
        let dynamicCSS = '';
        if (palette === 'motion-pro') {
            dynamicCSS += `
                .link-btn:hover { transform: translateY(-3px) scale(1.01); filter: brightness(1.1); box-shadow: 0 8px 15px rgba(0,0,0,0.2); }
                .social-icon:hover { transform: scale(1.2) rotate(3deg); }
            `;
        } else {
             dynamicCSS += `
                .link-btn:hover { filter: brightness(0.95); }
                .social-icon:hover { transform: scale(1.15); }
            `;
        }

        let mainContent = '';
        let pageStyles = `
            body { 
                font-family: '${fontFamily}', sans-serif; 
                margin: 0; padding: 40px 20px; min-height: 100vh; 
                background: ${data.design.bgColor}; color: ${data.design.textColor}; 
                display: flex; flex-direction: column; align-items: center; box-sizing: border-box; 
            }
            .container { width: 100%; max-width: 600px; text-align: center; }
            .avatar { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 15px; }
            .name { font-size: 26px; font-weight: 900; margin: 0 0 10px; }
            .bio { font-size: 16px; opacity: 0.9; margin-bottom: 30px; line-height: 1.6; }
            .socials { display: flex; justify-content: center; gap: 18px; margin-bottom: 30px; }
            .social-icon { color: inherit; transition: transform 0.3s ease; display: inline-block; }
            .link-btn { display: block; width: 100%; padding: 18px; margin-bottom: 15px; text-decoration: none; font-weight: 700; font-size: 18px; box-sizing: border-box; transition: all 0.3s; }
        `;

        if (templateId === 'sidebar') {
            // Sidebar Template Styles
            pageStyles += `
                .container { display: flex; flex-direction: row; gap: 20px; align-items: flex-start; text-align: ${isRTL ? 'right' : 'left'}; max-width: 800px; }
                .profile-section { flex-shrink: 0; width: 250px; text-align: center; }
                .links-section { flex-grow: 1; padding-top: 20px; }
                .name { margin-top: 0; font-size: 22px; }
                .bio { margin-bottom: 20px; font-size: 14px; }
                .socials { justify-content: ${isRTL ? 'right' : 'left'}; }
                @media (max-width: 650px) {
                    .container { flex-direction: column; align-items: center; }
                    .profile-section { width: 100%; text-align: center; }
                    .socials { justify-content: center; }
                    .links-section { width: 100%; }
                }
            `;
            mainContent = `
                <div class="container">
                    <div class="profile-section">
                        <img src="${safeAvatar}" alt="${safeName}" class="avatar">
                        <h1 class="name">${safeName}</h1>
                        <p class="bio">${safeBio}</p>
                        <div class="socials">${socialHTML}</div>
                    </div>
                    <div class="links-section">
                        <div class="links">${linksHTML}</div>
                    </div>
                </div>
            `;
        } else if (templateId === 'hero') {
             // Hero Banner Template
            pageStyles += `
                .hero-banner { width: 100%; height: 120px; background: ${data.design.linkBgColor}; margin-top: -40px; }
                .profile-info { margin-top: -60px; position: relative; }
                .container { padding: 0; }
                .links-section { padding: 0 20px; }
            `;
             mainContent = `
                <div class="container">
                    <div class="hero-banner"></div>
                    <div class="profile-info">
                        <img src="${safeAvatar}" alt="${safeName}" class="avatar">
                        <h1 class="name">${safeName}</h1>
                        <p class="bio">${safeBio}</p>
                        <div class="socials">${socialHTML}</div>
                    </div>
                    <div class="links-section">
                        <div class="links">${linksHTML}</div>
                    </div>
                </div>
            `;
        } else {
            // Classic Template
            mainContent = `
                <div class="container">
                    <img src="${safeAvatar}" alt="${safeName}" class="avatar">
                    <h1 class="name">${safeName}</h1>
                    <p class="bio">${safeBio}</p>
                    <div class="socials">${socialHTML}</div>
                    <div class="links">${linksHTML}</div>
                </div>
            `;
        }


        return `<!DOCTYPE html>
<html lang="${lang}" dir="${isRTL ? 'rtl' : 'ltr'}">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${safeName} | Links</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
<style>
    ${pageStyles}
    ${dynamicCSS}
</style>
</head>
<body>
    ${mainContent}
</body>
</html>`;
    }
    </script>
</body>
</html>