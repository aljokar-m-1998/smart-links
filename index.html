<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙÙ†Ø´Ø¦ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø°ÙƒÙŠØ© - Ø§Ù„Ù…Ø·ÙˆØ±</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        :root {
            --bg-color: #f0f2f5;
            --panel-bg: #ffffff;
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --border: #e5e7eb;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * { box-sizing: border-box; outline: none; }

        body {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ --- */
        #app { display: flex; width: 100%; height: 100%; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        aside {
            width: 420px;
            background: var(--panel-bg);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            z-index: 10;
            box-shadow: 5px 0 15px rgba(0,0,0,0.05);
        }

        .editor-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            background: #fff;
        }
        .editor-header h1 { margin: 0; font-size: 20px; display: flex; align-items: center; gap: 8px; }

        .editor-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Accordions) */
        details {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 15px;
            overflow: hidden;
            transition: all 0.2s;
        }
        details[open] { box-shadow: var(--shadow); border-color: var(--primary); }
        summary {
            padding: 15px;
            cursor: pointer;
            font-weight: 700;
            list-style: none;
            display: flex; justify-content: space-between; align-items: center;
        }
        summary::after { content: '+'; font-size: 18px; color: var(--text-muted); }
        details[open] summary::after { content: '-'; }
        
        .section-body { padding: 15px; border-top: 1px solid var(--border); background: #f9fafb; }

        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px; color: var(--text-muted); }
        input, textarea, select {
            width: 100%; padding: 10px 12px; border: 1px solid var(--border);
            border-radius: 8px; font-family: inherit; font-size: 14px;
            transition: border 0.2s;
        }
        input:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }

        /* Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª */
        .upload-box {
            border: 2px dashed var(--border);
            padding: 20px; text-align: center; border-radius: 8px;
            cursor: pointer; background: #fff; transition: 0.2s;
            position: relative;
        }
        .upload-box:hover { border-color: var(--primary); background: #f5f3ff; }
        .upload-box input { position: absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 10px 20px; border: none; border-radius: 8px;
            font-weight: 700; cursor: pointer; transition: 0.2s; gap: 8px; font-size: 14px;
        }
        .btn-full { width: 100%; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-success { background: #10b981; color: white; }
        .btn-secondary { background: #f3f4f6; color: var(--text-main); }
        .btn-danger { background: #fee2e2; color: #ef4444; padding: 8px; }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· */
        .link-card {
            background: #fff; padding: 12px; border: 1px solid var(--border);
            border-radius: 8px; margin-bottom: 10px; display: flex; gap: 10px; align-items: center;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .drag-handle { cursor: grab; color: #cbd5e1; font-size: 20px; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© */
        main {
            flex: 1;
            display: flex; justify-content: center; align-items: center;
            background-color: #e5e7eb;
            background-image: radial-gradient(#d1d5db 1px, transparent 1px);
            background-size: 20px 20px;
            padding: 20px;
            position: relative;
        }

        .phone-mockup {
            width: 360px; height: 720px;
            background: #fff;
            border-radius: 45px;
            border: 8px solid #1f2937;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            position: relative;
        }
        .notch {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 120px; height: 25px; background: #1f2937;
            border-bottom-left-radius: 16px; border-bottom-right-radius: 16px; z-index: 20;
        }
        #preview-screen {
            width: 100%; height: 100%; overflow-y: auto;
            scrollbar-width: none;
        }
        #preview-screen::-webkit-scrollbar { display: none; }

        /* Ù…ÙˆØ¯Ø§Ù„ ÙˆØªÙˆØ³Øª */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px);
            display: none; justify-content: center; align-items: center; z-index: 100;
        }
        .modal {
            background: white; padding: 30px; border-radius: 16px; width: 90%; max-width: 400px;
            text-align: center; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .toast {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px);
            background: #1f2937; color: white; padding: 12px 24px; border-radius: 50px;
            transition: 0.3s; opacity: 0; z-index: 200;
        }
        .toast.active { transform: translateX(-50%) translateY(0); opacity: 1; }

        /* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 900px) {
            #app { flex-direction: column-reverse; }
            aside { width: 100%; height: 60%; border-top: 1px solid var(--border); }
            main { height: 40%; padding: 10px; }
            .phone-mockup { width: 100%; height: 100%; border: 4px solid #333; border-radius: 20px; }
            .notch { display: none; }
        }
    </style>
</head>
<body>

    <div id="toast" class="toast">ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­</div>

    <div id="modal-overlay" class="modal-overlay">
        <div class="modal">
            <h2 style="margin-top:0">ğŸ‰ ØµÙØ­ØªÙƒ Ø¬Ø§Ù‡Ø²Ø©</h2>
            <div id="qrcode" style="display:flex; justify-content:center; margin: 20px 0;"></div>
            <input type="text" id="share-link" readonly style="text-align:center; background:#f3f4f6; border:none;">
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button onclick="copyLink()" class="btn btn-primary" style="flex:1">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
                <button onclick="closeModal()" class="btn btn-secondary">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
            <p style="font-size:12px; color:#666; margin-top:10px">ØªÙ„Ù…ÙŠØ­: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø·ÙˆÙŠÙ„Ø§Ù‹ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø®Ø¯Ù…Ø© bit.ly</p>
        </div>
    </div>

    <div id="app">
        <main>
            <div class="phone-mockup">
                <div class="notch"></div>
                <div id="preview-screen"></div>
            </div>
        </main>

        <aside>
            <div class="editor-header">
                <h1>âš¡ Ù…ÙÙ†Ø´Ø¦ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· <small style="font-size:12px; color:#666; font-weight:400">(Pro v2)</small></h1>
            </div>
            <div class="editor-content">
                
                <details open>
                    <summary>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</summary>
                    <div class="section-body">
                        <div class="form-group">
                            <label>Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ù…Ø²ÙŠØ© (Ø³ÙŠØªÙ… Ø¶ØºØ·Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)</label>
                            <div class="upload-box">
                                <span id="upload-text">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±Ø© ğŸ“·</span>
                                <input type="file" id="avatar-input" accept="image/*">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø§Ø³Ù…</label>
                            <input type="text" id="name-input" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„ÙˆØµÙ (Bio)</label>
                            <textarea id="bio-input" rows="2" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ±..."></textarea>
                        </div>
                    </div>
                </details>

                <details>
                    <summary>Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„</summary>
                    <div class="section-body" id="social-container">
                        </div>
                </details>

                <details open>
                    <summary>Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰</summary>
                    <div class="section-body">
                        <div id="links-container"></div>
                        <button onclick="addLink()" class="btn btn-secondary btn-full">Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯ â•</button>
                    </div>
                </details>

                <details>
                    <summary>Ø§Ù„Ù…Ø¸Ù‡Ø± ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†</summary>
                    <div class="section-body">
                        <div class="form-group">
                            <label>Ø§Ù„Ù‚Ø§Ù„Ø¨</label>
                            <select id="theme-select" onchange="applyTheme()">
                                <option value="light">ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ ÙØ§ØªØ­</option>
                                <option value="dark">ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ Ø¯Ø§ÙƒÙ†</option>
                                <option value="glass">Ø²Ø¬Ø§Ø¬ÙŠ Ø¹ØµØ±ÙŠ (Glass)</option>
                                <option value="gradient-blue">ØªØ¯Ø±Ø¬ Ø£Ø²Ø±Ù‚</option>
                                <option value="gradient-pink">ØºØ±ÙˆØ¨ Ø§Ù„Ø´Ù…Ø³</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø®ØµØµ</label>
                            <input type="color" id="bg-color-input" style="height:40px; padding:0;">
                        </div>
                    </div>
                </details>

                <div style="margin-top: 20px; display: grid; gap: 10px; grid-template-columns: 1fr 1fr;">
                    <button onclick="generateShareLink()" class="btn btn-primary" style="grid-column: span 2;">Ø­ÙØ¸ ÙˆÙ…Ø´Ø§Ø±ÙƒØ© ğŸš€</button>
                    <button onclick="shortenLink()" class="btn btn-success">ØªÙ‚ØµÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø· âœ‚ï¸</button>
                    <button onclick="downloadHTML()" class="btn btn-secondary">ØªØ­Ù…ÙŠÙ„ HTML ğŸ’¾</button>
                    <button onclick="exportJSON()" class="btn btn-secondary" style="grid-column: span 2; font-size:12px;">Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ (JSON)</button>
                </div>
            </div>
        </aside>
    </div>

    <script>
        const ICONS = {
            twitter: '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>',
            instagram: '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.85s.012-3.584.07-4.85c.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.85-.069zM12 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zm0 10.162a3.999 3.999 0 110-7.998 3.999 3.999 0 010 7.998z"/></svg>',
            facebook: '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"/></svg>',
            linkedin: '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452z"/></svg>',
            whatsapp: '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>'
        };

        // --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ---
        let data = {
            name: "Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§",
            bio: "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØµÙØ­ØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ© ğŸ‘‹",
            avatar: "",
            socials: { twitter: "", instagram: "", facebook: "", whatsapp: "" },
            links: [{ title: "Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ğŸŒ", url: "https://google.com" }],
            theme: "light",
            customBg: "#f7f8fa"
        };

        // --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ---
        document.addEventListener('DOMContentLoaded', () => {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø· (ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…)
            if (window.location.hash.startsWith('#data=')) {
                loadFromHash();
            } else {
                initEditor();
            }
        });

        function initEditor() {
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
            new Sortable(document.getElementById('links-container'), {
                handle: '.drag-handle',
                animation: 150,
                onEnd: updateLinksFromDOM
            });

            // ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„
            const socialContainer = document.getElementById('social-container');
            Object.keys(data.socials).forEach(key => {
                socialContainer.innerHTML += `
                    <div class="form-group">
                        <label style="text-transform:capitalize">${key}</label>
                        <input type="text" data-social="${key}" oninput="updateSocials(this)" placeholder="Username or URL">
                    </div>
                `;
            });

            // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            document.getElementById('name-input').addEventListener('input', (e) => { data.name = e.target.value; render(); });
            document.getElementById('bio-input').addEventListener('input', (e) => { data.bio = e.target.value; render(); });
            document.getElementById('bg-color-input').addEventListener('input', (e) => { data.customBg = e.target.value; data.theme = 'custom'; document.getElementById('theme-select').value = 'custom'; render(); });

            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ØµÙˆØ±Ø© ÙˆØ¶ØºØ·Ù‡Ø§
            document.getElementById('avatar-input').addEventListener('change', handleImageUpload);

            render();
            renderLinksInputs();
        }

        // --- ÙˆØ¸ÙŠÙØ© Ø¶ØºØ· Ø§Ù„ØµÙˆØ± (Ø£Ù‡Ù… ØªØ­Ø¯ÙŠØ«) ---
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (event) {
                const img = new Image();
                img.onload = function () {
                    // Ø¥Ù†Ø´Ø§Ø¡ Canvas Ù„Ù„Ø¶ØºØ·
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø£Ø¨Ø¹Ø§Ø¯ Ù‚ØµÙˆÙ‰ (Ù…Ø«Ù„Ø§Ù‹ 150 Ø¨ÙƒØ³Ù„)
                    const maxSize = 150;
                    let width = img.width;
                    let height = img.height;

                    if (width > height) {
                        if (width > maxSize) { height *= maxSize / width; width = maxSize; }
                    } else {
                        if (height > maxSize) { width *= maxSize / height; height = maxSize; }
                    }

                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);

                    // ØªØ­ÙˆÙŠÙ„ Ù„Ù€ Base64 Ø¨Ø¬ÙˆØ¯Ø© Ù…Ù†Ø®ÙØ¶Ø© (0.7)
                    data.avatar = canvas.toDataURL('image/jpeg', 0.7);
                    document.getElementById('upload-text').innerText = "âœ… ØªÙ… Ø¶ØºØ· ÙˆØ±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©";
                    render();
                }
                img.src = event.target.result;
            }
            reader.readAsDataURL(file);
        }

        // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ---
        function addLink() {
            data.links.push({ title: "Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯", url: "" });
            renderLinksInputs();
            render();
        }

        function removeLink(index) {
            data.links.splice(index, 1);
            renderLinksInputs();
            render();
        }

        function renderLinksInputs() {
            const container = document.getElementById('links-container');
            container.innerHTML = '';
            data.links.forEach((link, index) => {
                container.innerHTML += `
                    <div class="link-card" data-index="${index}">
                        <span class="drag-handle">â˜°</span>
                        <div style="flex:1">
                            <input type="text" value="${link.title}" oninput="updateLink(${index}, 'title', this.value)" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" style="margin-bottom:5px">
                            <input type="url" value="${link.url}" oninput="updateLink(${index}, 'url', this.value)" placeholder="https://...">
                        </div>
                        <button onclick="removeLink(${index})" class="btn btn-danger">ğŸ—‘ï¸</button>
                    </div>
                `;
            });
        }

        function updateLink(index, key, value) {
            data.links[index][key] = value;
            render();
        }

        function updateLinksFromDOM() {
            const newLinks = [];
            document.querySelectorAll('.link-card').forEach(card => {
                const index = card.getAttribute('data-index');
                const title = card.querySelector('input[type="text"]').value;
                const url = card.querySelector('input[type="url"]').value;
                newLinks.push({ title, url });
            });
            data.links = newLinks;
            renderLinksInputs(); // Re-render to fix indexes
            render();
        }

        function updateSocials(input) {
            data.socials[input.dataset.social] = input.value;
            render();
        }

        function applyTheme() {
            const theme = document.getElementById('theme-select').value;
            data.theme = theme;
            render();
        }

        // --- Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (Render) ---
        function render() {
            const screen = document.getElementById('preview-screen');
            
            // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø«ÙŠÙ…
            let styles = {
                bg: data.customBg,
                text: '#1f2937',
                btnBg: '#ffffff',
                btnText: '#000000',
                radius: '12px'
            };

            if (data.theme === 'dark') { styles = { bg: '#111', text: '#fff', btnBg: '#222', btnText: '#fff' }; }
            else if (data.theme === 'glass') { styles = { bg: 'linear-gradient(45deg, #FF9A9E 0%, #FECFEF 99%, #FECFEF 100%)', text: '#333', btnBg: 'rgba(255,255,255,0.4)', btnText: '#000' }; }
            else if (data.theme === 'gradient-blue') { styles = { bg: 'linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%)', text: '#1e3c72', btnBg: '#fff', btnText: '#1e3c72' }; }
            
            // CSS Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
            const css = `
                display: flex; flex-direction: column; align-items: center; padding: 40px 20px;
                min-height: 100%; background: ${styles.bg}; color: ${styles.text};
                font-family: 'Cairo', sans-serif; text-align: center;
            `;

            // HTML Ø§Ù„ØµÙˆØ±Ø©
            const avatarHtml = data.avatar ? `<img src="${data.avatar}" style="width:100px; height:100px; border-radius:50%; margin-bottom:15px; border:3px solid rgba(255,255,255,0.5); object-fit:cover;">` : '';

            // HTML Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„
            let socialHtml = '<div style="display:flex; gap:15px; margin-bottom:25px;">';
            Object.keys(data.socials).forEach(k => {
                if (data.socials[k]) {
                    socialHtml += `<span style="color:${styles.text}; opacity:0.8">${ICONS[k]}</span>`;
                }
            });
            socialHtml += '</div>';

            // HTML Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
            let linksHtml = '<div style="width:100%; display:flex; flex-direction:column; gap:12px;">';
            data.links.forEach(l => {
                const glassEffect = data.theme === 'glass' ? 'backdrop-filter: blur(5px); border:1px solid rgba(255,255,255,0.3);' : 'box-shadow: 0 4px 6px rgba(0,0,0,0.05);';
                linksHtml += `
                    <div style="
                        background: ${styles.btnBg}; color: ${styles.btnText};
                        padding: 16px; border-radius: ${styles.radius};
                        font-weight: bold; text-decoration: none;
                        ${glassEffect}
                    ">${l.title || 'Ø±Ø§Ø¨Ø·'}</div>
                `;
            });
            linksHtml += '</div>';

            screen.innerHTML = `
                <div style="${css}">
                    ${avatarHtml}
                    <h2 style="margin:0 0 5px;">${data.name}</h2>
                    <p style="margin:0 0 20px; opacity:0.8; font-size:14px;">${data.bio}</p>
                    ${socialHtml}
                    ${linksHtml}
                </div>
            `;
        }

        // --- Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØµØ¯ÙŠØ± ---
        function getCompressedData() {
            const json = JSON.stringify(data);
            return LZString.compressToEncodedURIComponent(json);
        }

        function generateShareLink() {
            const compressed = getCompressedData();
            const url = `${window.location.origin}${window.location.pathname}#data=${compressed}`;
            
            document.getElementById('share-link').value = url;
            document.getElementById('qrcode').innerHTML = "";
            
            if(url.length < 2000) {
                new QRCode(document.getElementById('qrcode'), { text: url, width: 128, height: 128 });
            } else {
                document.getElementById('qrcode').innerHTML = "<p style='color:red; font-size:12px'>Ø§Ù„Ø±Ø§Ø¨Ø· Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ù€ QR (Ø¨Ø³Ø¨Ø¨ Ø§Ù„ØµÙˆØ±Ø©)ØŒ Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø©.</p>";
            }
            
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        async function shortenLink() {
            const compressed = getCompressedData();
            const longUrl = `${window.location.origin}${window.location.pathname}#data=${compressed}`;
            
            // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ¯Ø¹Ù… Ø§Ù„Ø·ÙˆÙ„ØŒ Ù„ÙƒÙ† Ø¹Ø§Ø¯Ø© Base64 Ù„Ù„ØµÙˆØ± ÙŠÙƒØ³Ø± Ø­Ø¯ÙˆØ¯ GET request
            // Ù„Ø°Ø§ Ø³Ù†Ø³ØªØ®Ø¯Ù… tinyurl ÙƒØ­Ù„ Ø¨Ø³ÙŠØ·
            const btn = document.querySelector('.btn-success');
            const originalText = btn.innerText;
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";
            
            try {
                const res = await fetch(`https://tinyurl.com/api-create.php?url=${longUrl}`);
                if (res.ok) {
                    const shortUrl = await res.text();
                    document.getElementById('share-link').value = shortUrl;
                    document.getElementById('qrcode').innerHTML = "";
                    new QRCode(document.getElementById('qrcode'), { text: shortUrl, width: 128, height: 128 });
                    document.getElementById('modal-overlay').style.display = 'flex';
                } else {
                    alert("Ø§Ù„Ø±Ø§Ø¨Ø· Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§Ù‹ Ù„Ù„ØªÙ‚ØµÙŠØ± Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ±Ø© Ø£ØµØºØ± Ø£Ùˆ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±.");
                }
            } catch (e) {
                generateShareLink(); // Fallback
            }
            btn.innerText = originalText;
        }

        function downloadHTML() {
            const htmlContent = `<!DOCTYPE html><html dir="rtl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>${data.name}</title><style>body{margin:0}</style></head><body>${document.getElementById('preview-screen').innerHTML}</body></html>`;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'my-links.html';
            link.click();
            showToast();
        }

        function exportJSON() {
            const json = JSON.stringify(data, null, 2);
            navigator.clipboard.writeText(json).then(() => {
                const t = document.getElementById('toast');
                t.innerText = "ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ JSON Ù„Ù„Ø­Ø§ÙØ¸Ø©!";
                t.classList.add('active');
                setTimeout(() => t.classList.remove('active'), 3000);
            });
        }

        // --- Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ---
        function copyLink() {
            const copyText = document.getElementById("share-link");
            copyText.select();
            document.execCommand("copy");
            showToast();
        }

        function closeModal() {
            document.getElementById('modal-overlay').style.display = 'none';
        }

        function showToast() {
            const t = document.getElementById('toast');
            t.classList.add('active');
            setTimeout(() => t.classList.remove('active'), 3000);
        }

        // --- ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ (Render Mode) ---
        function loadFromHash() {
            try {
                const hash = window.location.hash.substring(6);
                const json = LZString.decompressFromEncodedURIComponent(hash);
                data = JSON.parse(json);
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø­Ø±Ø± ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙ‚Ø· Ø¨Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
                document.querySelector('aside').style.display = 'none';
                document.querySelector('main').style.padding = '0';
                document.querySelector('main').style.background = '#fff';
                
                const previewFrame = document.querySelector('.phone-mockup');
                previewFrame.style.border = 'none';
                previewFrame.style.borderRadius = '0';
                previewFrame.style.boxShadow = 'none';
                previewFrame.style.width = '100%';
                previewFrame.style.height = '100vh';
                document.querySelector('.notch').style.display = 'none';

                render();

                // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
                document.title = data.name;

            } catch (e) {
                console.error("Error loading data", e);
                window.location.hash = "";
                location.reload();
            }
        }
    </script>
</body>
</html>
